<!-- PatrÃ³n: Mediator â€” esta vista coordina editor, chat y notificaciones vÃ­a Mediator y Observer. -->
<div class="editor-container">
    <app-notifications></app-notifications>
    <header class="editor-toolbar">
        <div class="doc-info">
            <h2>{{ document?.name }}</h2>
            <span class="doc-type">{{ document?.type }}</span>
        </div>

        <div class="toolbar-actions">
            <button (click)="toggleBold()" title="Negrita">
                <i class="fa-solid fa-bold"></i> Negrita
            </button>
            <button (click)="toggleItalic()" title="Cursiva">
                <i class="fa-solid fa-italic"></i> Cursiva
            </button>
            <button (click)="toggleUnderline()" title="Subrayado">
                <i class="fa-solid fa-underline"></i> Subrayado
            </button>

            <div class="divider"></div>

            <button (click)="setAlignment('left')" [class.active]="alignment === 'left'">
                <i class="fa-solid fa-align-left"></i> Izquierda
            </button>
            <button (click)="setAlignment('center')" [class.active]="alignment === 'center'">
                <i class="fa-solid fa-align-center"></i> Centro
            </button>
            <button (click)="setAlignment('right')" [class.active]="alignment === 'right'">
                <i class="fa-solid fa-align-right"></i> Derecha
            </button>

            <div class="divider"></div>

            <button (click)="toggleWordCount()" [class.active]="useWordCount" title="Contador de palabras">
                <i class="fa-solid fa-list-ol"></i> Contador
            </button>
            <button (click)="toggleSyntaxHighlight()" [class.active]="useSyntaxHighlight" title="Resaltado Markdown">
                <i class="fa-solid fa-code"></i> Markdown
            </button>
            <button (click)="openDetailView()" title="Abrir detalle">
                <i class="fa-solid fa-external-link-alt"></i> Detalle
            </button>
            <button (click)="toggleTextFormat()" [class.active]="useTextFormat" title="Formato de texto">
                <i class="fa-solid fa-text-height"></i> Formato
            </button>
            <button (click)="toggleAutoSave()" [class.active]="useAutoSave" title="Guardado automÃ¡tico">
                <i class="fa-solid fa-robot"></i> Auto-guardado
            </button>

            <button (click)="saveDocument()" class="save-btn">
                <i class="fa-solid fa-save"></i> Guardar
            </button>
        </div>
    </header>

    <main class="editor-body">
        <div #editor class="editable" contenteditable="true" (input)="onEditorInput()" dir="ltr" spellcheck="true" [innerHTML]="content | safeHtml" placeholder="Empieza a escribir aquÃ­..."></div>

        <!-- Presencia integrada (usuarios + chat) -->
        <aside class="preview-area">
            <section class="embedded-presence">
                <app-user-list></app-user-list>
                <div class="spacer-8" aria-hidden="true"></div>
                <app-chat></app-chat>
            </section>
        </aside>
    </main>

    <footer class="editor-footer">
        <div class="footer-left">
            <span>CaracterÃ­sticas: 
                <span *ngIf="useWordCount">Contador</span>
            <span *ngIf="useSyntaxHighlight">, Markdown</span>
            <span *ngIf="useTextFormat">, Formato</span>
            <span *ngIf="useAutoSave">, Auto-guardado</span>
            </span>
        </div>
        <div class="footer-right">
            <span>Palabras: {{ wordCount }}</span>
            <span *ngIf="useAutoSave" class="auto-save-indicator">ðŸ’¾</span>
        </div>
    </footer>
</div>

<!-- Modal overlay para mostrar detalle de documento sin navegar -->
<div class="modal-overlay" *ngIf="modalOpen" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeModal()" aria-label="Cerrar">Ã—</button>
        <app-document-detail [documentInput]="modalDocument" (closed)="closeModal()" (saved)="onModalSaved($event)"></app-document-detail>
    </div>
</div>